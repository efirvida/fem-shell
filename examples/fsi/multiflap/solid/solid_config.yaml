# FSI Simulation Configuration - Multi-Flap Case
# ===============================================
# This YAML configuration replaces solid.py for the multiflap FSI case.
# Time parameters (total_time, time_step) and watchpoints are automatically
# read from the preCICE configuration file (precice-config.xml).

#============================================================================
# MESH CONFIGURATION
#============================================================================
mesh:
  # Generate multi-flap mesh programmatically
  source: "generator"
  generator:
    type: "MultiFlapMesh"
    params:
      n_flaps: 5           # Number of flaps
      flap_width: 0.1      # Width of each flap [m]
      flap_height: 1.0     # Height of each flap [m]
      x_spacing: 2.0       # Spacing between flaps [m]
      base_height: 0.05    # Base strip height [m]
      nx_flap: 4           # Elements per flap width
      ny_flap: 26          # Elements per flap height (ny from case_config.json)
      nx_base_segment: 10  # Elements in base segments
      ny_base: 2           # Elements in base height
      quadratic: true      # Use quadratic elements

  # Output mesh file (format inferred from extension)
  # Supported: .vtk, .vtu, .msh, .inp (CalculiX), .h5/.hdf5, .obj, .stl
  output_file: "mesh_multiflap.vtk"

#============================================================================
# MATERIAL DEFINITION
#============================================================================
material:
  type: "isotropic"
  name: "Flap_Material"
  E: 4.0e6       # Young's modulus [Pa] (4000000 from case_config.json)
  nu: 0.3        # Poisson's ratio [-]
  rho: 3000.0    # Density [kg/mÂ³]

#============================================================================
# ELEMENT CONFIGURATION
#============================================================================
elements:
  family: "PLANE"  # 2D plane stress/strain elements

#============================================================================
# SOLVER CONFIGURATION
# Note: total_time and time_step are read automatically from precice-config.xml
#       (<max-time> and <time-window-size> respectively)
#============================================================================
solver:
  type: "LinearDynamicFSI"
  # total_time: auto from <max-time value="120"/>
  # time_step: auto from <time-window-size value="0.001"/>
  
  newmark:
    beta: 0.25
    gamma: 0.5

#============================================================================
# BOUNDARY CONDITIONS
#============================================================================
boundary_conditions:
  # Fixed at base bottom (the "bottom" node set is an alias for "base_bottom")
  dirichlet:
    - nodeset: "bottom"
      value: 0.0

  body_forces: []

#============================================================================
# FSI COUPLING (preCICE) - Inline configuration
#============================================================================
coupling:
  # preCICE participant name
  participant: "Solid"
  # Path to preCICE configuration file (relative to this config file)
  config_file: "../precice-config.xml"
  
  # Interface configuration
  interface:
    coupling_mesh: "Solid-Mesh"
    write_data: "Displacement"
    read_data: "Force"
  
  # All flap surfaces exposed to fluid
  boundaries:
    - "flaps_left"
    - "flaps_top"
    - "flaps_right"

#============================================================================
# OUTPUT & CHECKPOINT CONFIGURATION
#============================================================================
output:
  folder: "results"
  write_interval: 0.1    # Checkpoint every 0.1s (from case_config.json)
  start_from: "latestTime"  # Resume from last checkpoint if available
  start_time: 0.0
  save_deformed_mesh: true
  deformed_mesh_scale: 1.0
  write_initial_state: true

#============================================================================
# POST-PROCESSING
# Note: watchpoint_files are auto-detected from <watch-point> in precice-config.xml
#============================================================================
postprocess:
  # watchpoint_files: auto-detected from preCICE config
  # Will find: precice-Solid-watchpoint-Flap1-Tip.log, etc.
  plots:
    displacement: "desplazamientos.png"
    force: "fuerzas.png"
